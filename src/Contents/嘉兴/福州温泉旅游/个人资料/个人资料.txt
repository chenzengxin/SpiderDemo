<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>乐途旅游</title>
<meta name="keywords" content="letu">
<meta name="description" content="letu">
<meta http-equiv="Content-Type" content="text/html; charset=urf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="乐途旅游">
<meta name="application-name" content="旅途旅游 | lotour.com">
<link rel="shortcut icon" href="http://www.lotour.com/favicon2.ico" />
<link rel="stylesheet" href="http://css.lotour.com/base.css" media=screen />
<link rel="stylesheet" href="http://css.lotour.com/common.css?v=20151116" media=screen />
<script src="http://js.lotour.net/jquery-1.8.3.min.js"></script>
<script src="http://js.lotour.com/common.js"></script>
<script src="js/login-reg.js"></script>
<script type="text/javascript">
var usertype = -1;
var hidecode = -1;
var returnurl = GetQueryString("ReturnUrl");
function setErrMsg(msg) {
	 if(msg!=""){
   $("#msg_psshow").html(msg);
	$("#msg_psshow").addClass("psshow");
	}
	 else{
		  $("#msg_psshow").html(msg).removeClass("psshow");
	 }
}
function changeValidatePic(obj) {
	//document.getElementById("validatepic").src =  "/getPictureCode?t=" + (new Date());
	 $(obj).attr("src", "/getPictureCode?t=" + Math.random());
}
function validateParms() {
	setErrMsg("");
	if ($('#loginName').val().length < 1) {
		setErrMsg("用户名不能为空");
		return false;
	}
	if ($('#pwd').val().indexOf(' ') != -1) {
		setErrMsg("密码中不能包含空格");
		return false;
	}
	if ($.trim($('#pwd').val()).length < 6||$.trim($('#pwd').val()).length>16) {
		 setErrMsg("密码应为6-16位字符");
		return false;
	}
	if (hidecode==1&&$.trim($('#ecode').val()).length <= 0) {
		setErrMsg("验证码不能为空");
		return false;
	}
	setErrMsg("");
	return true;
}

jQuery(function() {
	getBGpicturl();
	document.getElementById("douban").href = host + "doubanLogin";
	document.getElementById("linkedin").href = host + "linkedinLogin";
	document.getElementById("weixin").href = host + "weixinLogin";
	document.getElementById("weibo").href = host + "weiboLogin";
	document.getElementById("qq").href = host + "QQLogin";
	$("input[type=submit]").click(
			function(){
				loginFuntion()
			}
	);
    $("#loginName,#pwd,#ecode").bind("keydown", function (e) {
        if (e.keyCode == 13) {
        	loginFuntion();
        }
    });
});

function loginFuntion() {
	if (!validateParms()) {
		return false;
	} else {
		setErrMsg("");
		jQuery.ajax({
					//url : 'http://my.lotour.com/login/login/login',
					url : 'loginApp',
					type : "get",
					data : {
						"loginname" : $.trim($('#loginName').val()),
						"psw" : $('#pwd').val(),
						"save" : 0,
						"auto":($("#autoLogin").hasClass('on') ? 1 : 0),
						"inputcode":$.trim($("#ecode").val())
					},
					cache : false,
					dataType : "jsonp",
					contentType : "application/x-www-form-urlencoded; charset=utf-8",
					success : function(data) {
						if (data.code == 1) {
							if($.trim(returnurl)==""){
								window.location="http://my.lotour.com/i/"+data.memberId;
								return false;
							}
							else{
							window.location=returnurl;
							return false;
							}
						} else {
							if (data.verifyCode == true) {
				                $("#hidecode").find("img").attr("src", "/getPictureCode?t=" + Math.random());
				                $("#hidecode").show();
				                hidecode= 1;
				            } else {
				            	$("#hidecode").hide();
				            }
			                if (parseInt(data.code) == -13) {
			                	setErrMsg("该账号不存在");
			                }
			                else if (parseInt(data.code) == -15) {
			                	setErrMsg("密码错误");
			                }
			                //验证码
			                else if (parseInt(data.code) == -31 || parseInt(data.code) == -32) {
			                	setErrMsg("验证码不正确");
			                }
			                //安全
			                else if (parseInt(data.code)==-39) {
			                	 $("#hidecode").find("img").attr("src", "/getPictureCode?t=" + Math.random());
					                $("#hidecode").show();
					                hidecode= 1;
			                	$("#msg_psshow").html("您登录操作频繁，请1小时以后再登录！");
			                }
			                else if (parseInt(data.code) > -40 && parseInt(data.code) <= -30) {
			                	 $("#msg_psshow").html("此账号已被禁用");
			                	//setErrMsg("此账号已被禁用");
			                }
						}
					},
					complete : function() {

					},
					error : function(ex) {
						console.log("123");
					}
				});
	}
}
</script>
</head>
<body class="find login-page"  style="">
	<div class="lg-tt"></div>
	<div class="lg-layer" id="lg-layer">
		<div class="in">
			<ul class="third clearfix">
				<li class="i2">
					<a id="weibo" href=""></a>
				</li>
				<li class="i3">
					<a href=""  id="qq"></a>
				</li>
				<li class="i4">
					<a id="weixin"></a>
				</li>
				<li class="i5">
					<a id="douban"></a>
				</li>
				  <li class="i7">
					<a href=""  id="linkedin"></a>
				</li>
			</ul>
			 <p class="td-btn"><a href="" class="o1">更多</a><a href="" class="o2">返回</a></p>
			<div class="lg-btm">
			<p class="ps " id="msg_psshow"></p>
			<p class="ty"><input class="txt tl wrong" placeholder="您的邮箱/手机号" value=""  type="text"  id="loginName"/><p>
			<p class="ty"><input class="txt tl" placeholder="您的密码" value="" type="password"  id="pwd"/></p>
			<p class="ty clearfix" id="hidecode"  style="display: none;"><input class="txt ck" placeholder="验证码" value="" type="text" id="ecode"/><img class="code" src=""  onclick="changeValidatePic(this);"/></p>
			<p class="tool clearfix" ><label class="on"  id="autoLogin">自动登录</label><a href="forget/index.html">忘记密码？</a></p>
			<p class="sub clearfix"><input value="立即登录" type="submit"  onclick="_gaq.push(['_trackPageview','/PageAction/login/immediately/']);"/><p>
		</div>
		</div>
		<p class="tip">还没有账号？<a href="regist.html">点击这里注册</a></p>
	</div>
		<div class="lg-bt"><p id="youji"></p></div>
		<script src="js/lotour-count.js"></script>
</body>
</html>
