<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>乐途旅游</title>
<meta name="keywords" content="letu">
<meta name="description" content="letu">
<META HTTP-EQUIV="Cache-Control" CONTENT="max-age=0" />
<meta http-equiv="Content-Type" content="text/html; charset=urf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="乐途旅游">
<meta name="application-name" content="旅途旅游 | lotour.com">
<link rel="shortcut icon" href="http://www.lotour.com/favicon2.ico">
<link rel="stylesheet" href="http://css.lotour.com/base.css" media=screen />
<link rel="stylesheet" href="http://css.lotour.com/common.css" media=screen />
<script src="http://js.lotour.net/jquery-1.8.3.min.js"></script>
<script src="http://js.lotour.com/common.js"></script>
<script src="js/login-reg.js"></script>
<style type="text/css">
	.ps {
	padding-left:20px;
	font:14px/20px \5FAE\8F6F\96C5\9ED1; 
	color:#333
	}
</style>
 <script type="text/javascript">
	var returnurl = GetQueryString("ReturnUrl");
	//发送短信计时
	function countDown() {
	 	var st=60;
	 	var tot=setInterval(function(){
	 				st--
	 				if(st==0){
	 					clearInterval(tot);
	 					$("#resent").html('重新获取验证码');
	 					$("#resent").attr("disabled", false);
	 					 $("#resent").css("background", "#F2F2F2");
	 					return false
	 				}else{
	 				$("#resent").html(st+'秒后重发');
	 				$("#resent").css("background","#c0c0c0");
	 				$("#resent").attr("disabled", "disabled");
	 				}
	 		},1000)
	 }
	jQuery(function() {
		changeValidatePic();
		getBGpicturl();//获取背景图片URL
		 $("#resent").css("background","#c0c0c0");
		 $("#resent").attr("disabled", "disabled");
		 $(".resent").bind("click",
					function() {
			 			if(!validateImgCode()){
			 				return false;
			 			}
			 			if(!isMobile($.trim($('#txtemail').val()))){
			 				setErrMsg("请输入正确的手机号码！");
			 				return false;
			 			}
						jQuery.ajax({
									url : 'reg/sendCode',
									type : "get",
									data : {
										"mobile" : $.trim($('#txtemail').val()),
										"imgCode" : $('#login_v4tcode').val()
									},
									cache : false,
									dataType : "jsonp",
									contentType : "application/x-www-form-urlencoded; charset=utf-8",
									beforeSend : function() {
										$("#resent").attr("disabled","disabled");
									},
									success : function(data) {
										if (data.code == 1) {
											 countDown();
										} else {
											$("#resent").attr("disabled",false);
											setErrMsg( data.msg);
											changeValidatePic();
										}
									},
									error : function() {
										$("#resent").attr("disabled", false);
									}
								});
					}); 
			$("input[type=submit]").click(
					function() {
						if (!validateParms()) {
							return false;
						} else {
							setErrMsg("");
							jQuery.ajax({
										url : 'reg/addUser',
										type : "get",
										data : {
											"mobile" : $.trim($('#txtemail').val()),
											"password" : $('#txtpassword').val(),
											"vcode" : $('#ecode').val(),
											"nickName":$('#txtname').val()
										},
										cache : false,
										dataType : "jsonp",
										contentType : "application/x-www-form-urlencoded; charset=utf-8",
										success : function(data) {
											if (data.code == 1) {
												window.location="regsucess.html?memberid="+data.t+"&returnurl="+returnurl;
											} else {
												alert(data.msg);
											}
										},
										error : function(ex) {
										}
									});
						}
					});
			seturl();
	});		 
	function seturl(){
		$(".logintxt").find("a").attr("href", "login.html?ReturnUrl="+returnurl);
	}
	function validatePass() {
		 setErrMsg("");
		if ($('#txtpassword').val().indexOf(' ') != -1) {
			setErrMsg("密码中不能包含空格！");
			return false;
		}
		if(ckChinese($('#txtpassword').val())){
			setErrMsg("密码中不能包含汉字！");
			return false;
		}
		if ($.trim($('#txtpassword').val()).length < 6||$.trim($('#txtpassword').val()).length>16) {
			 $("#msg_psshow").html("密码应为6-16位字符!");
			return false;
		}
		 setErrMsg("");
	}
function validateParms() {
	 	setErrMsg("");
		var loginNameValue = $.trim(document.getElementById("txtemail").value);
		if(!isMobile(loginNameValue)){
			setErrMsg("请输入正确的手机号码！");
			return false;
		}
		if ($.trim($('#txtname').val()).length <= 0) {
			$("#msg_psshow").html("请填写昵称!");
			return false;
		}
		if(stripscript($('#txtname').val())){
			setErrMsg("昵称包含特殊字符！");
			return false;
		}
		if ($.trim($('#txtname').val()).length < 2
				|| $.trim($('#txtname').val()).length > 32) {
			$("#msg_psshow").html("昵称应为2-32位字符！");
			return false;
		}
		if ($('#txtpassword').val().indexOf(' ') != -1) {
			setErrMsg("密码中不能包含空格！");
			return false;
		}
		if(ckChinese($('#txtpassword').val())){
			setErrMsg("密码中不能包含汉字！");
			return false;
		}
		if ($.trim($('#txtpassword').val()).length < 6||$.trim($('#txtpassword').val()).length>16) {
			 $("#msg_psshow").html("密码应为6-16位字符！");
			return false;
		}
		if ($.trim($('#ecode').val()).length <= 0) {
			setErrMsg("验证码不能为空！");
			return false;
		}
		setErrMsg("");
		return true;
	}
function validateNickname() {
	 setErrMsg("");
	if ($.trim($('#txtname').val()).length <= 0) {
		 $("#msg_psshow").html("请填写昵称！");
		return false;
	}
	if(stripscript($('#txtname').val())){
		setErrMsg("昵称包含特殊字符！");
		return false;
	}
	if ($.trim($('#txtname').val()).length < 2|| $.trim($('#txtname').val()).length > 32) {
		 $("#msg_psshow").html("昵称应为2-32位字符！");
		return false;
	}
	setErrMsg("");
	return true;
}
function validateCode() {
	 setErrMsg("");
	if ($.trim($('#ecode').val()).length <= 0) {
		setErrMsg("验证码不能为空！");
		return false;
	}
	if ($.trim($('#ecode').val()).length != 6) {
		$("#msg_psshow").html("请输入六位验证码！");
		return false;
	}
	setErrMsg("");
}
function validateImgCode() {
	 setErrMsg("");
	if ($.trim($('#login_v4tcode').val()).length <= 0) {
		setErrMsg("验证码不能为空！");
		return false;
	}
	setErrMsg("");
    return true;
}
function setErrMsg(msg) {
		 if(msg!=""){
	    $("#msg_psshow").html(msg);
		$("#msg_psshow").addClass("psshow");
		$("#resent").css("background","#c0c0c0");
		$("#resent").attr("disabled", "disabled");
		}
		 else{
			  $("#msg_psshow").html(msg).removeClass("psshow");
			  $("#resent").css("background", "#F2F2F2");
			  $("#resent").attr("disabled",false);
		 }
}
 function validateEmail() {
	 setErrMsg("");
   // setAllTextDisable(false);
    var loginNameValue = $.trim($('#txtemail').val());
    if (!isMobile(loginNameValue)) {
        setErrMsg("请输入正确的手机号码！");
        return false;
    }
	jQuery.ajax({
		url : 'reg/judgeMobileStatus',
		type : "get",
		data : {
			"mobile" : loginNameValue
		},
		cache : false,
		dataType : "jsonp",
		contentType : "application/x-www-form-urlencoded; charset=utf-8",
		success : function(data) {
			 $("#checking").addClass("sphl");
		        if (data.code == 1) {
		            setErrMsg( "该手机号码已被占用！");
		        }
		        else if (data.code == -1) {
		            setErrMsg("请输入正确的手机号码！");
		        }
		        else if (data.code == 2) {
		            setErrMsg("该手机号码已被占用！");
		        }
		        //else if (data.code == 0) {
		           // setErrMsg(id, '您的手机号码未激活，请<a target="_self" href="http://my.lotour.com/login/UserReg/MobileValidate?mobile=' + loginNameValue + '">【激活】</a>使用！');
		        //}
		        else {
		            $("#msg_psshow").html("手机号码可以注册");
		            return true;
		          //  $("#sendMobileCode").html("获取短信验证码").removeAttr("disabled");
		        }
		},
		error : function() {
			$("#resent").attr("disabled", false);
		}
	});
}
//更改验证码
 function changeValidatePic() {
 	document.getElementById("validatepic").src = host+ "getPictureCode?t=" + (new Date());
 	 //$(obj).attr("src", host+"getPictureCode?t=" + Math.random());
 }
 </script>
 </head>
<body class="find" style="">
	<div class="lg-tt"></div>
	<div class="lg-layer re-layer re-layer-a" id="lg-layer">
		<div class="in">
			<p class="ps"  id="msg_psshow" style=""> </p>
			<p class="ty"><input class="txt tl" placeholder="您的手机号码" value="" type="text" name="txtemail" id="txtemail" onblur="validateEmail();"  /></p>
			<p class="ty"><input class="txt tl" placeholder="您的昵称" value="" type="text" name="txtname" id="txtname" onblur="validateNickname()"/></p>
			<p class="ty"><input class="txt tl" placeholder="您的密码" value="" type="password" name="txtpassword" id="txtpassword"/ onblur="validatePass()"><img src="http://img1.lotour.com/common/sps.png" class="sps" /></p>
			<p class="ty clearfix" id="login_v4pcode" style="display: block;"><input id="login_v4tcode"  name="imgCode" class="txt ck" placeholder="验证码" value="" type="text" onmouseout="validateImgCode()"  onblur="validateImgCode()"><img class="code wdith127" src=""  id="validatepic" onclick="changeValidatePic()"></p>            
			<p class="ty clearfix"><input class="txt ck" placeholder="短信验证码" value="" type="text" name="vcode" id="ecode"  onblur="validateCode()"/><button  id="resent" class="resent" style="">获取验证码</button></p>
			<p class="sub clearfix"><input value="完成注册" type="submit" id="regbutton" name="regbutton"  onclick="_gaq.push(['_trackPageview','/PageAction/regist/complete/']);"/></p>
			<p class="tk">注册视为同意乐途旅游网<a href="http://corp.lotour.com/term.shtml"  target="_blank">服务条款</a></p>
		</div>
		<p class="logintxt"><a href="">合作网站账号登录/乐途账号登录</a></p>
	</div>
	<div class="lg-bt"><p id="youji"></p></div>
	<script src="js/lotour-count.js"></script>
</body>
</html>